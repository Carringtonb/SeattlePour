# Seattle Pour Vulnerabilty Report

## Seattle Pour

*Authors: Teddy Damian and Carrington Beard*

### Vulnerability 1

#### Exposure
*Broken Authentication:* Locking out a user after x amount of incorrect credentials

*Lockout User:* Not having a set amount of attempts that someone can enter incorrect 
credentials before being assigned an account lockout of predetermined length allows for password guessing.
Hackers could spend an infinite amount of time guessing until something stuck.

#### Repair

Login.cshtml.cs contains the vulnerability. This vulnerability is easily addressed using ASP.NET Core Identity and implementing the lockout feature.
We can use Identity by calling `UseAuthentication` in our Startup.cs file

```    
                
            app.UseStaticFiles();
            app.UseAuthentication();
            app.UseAuthorization();
=========================================================================================
               services.AddIdentity<ApplicationUser, IdentityRole>()
                .AddEntityFrameworkStores<ApplicationDbContext>()
                .AddDefaultTokenProviders();
```

#### Resources
[OWASP - Broken Authentication](https://cheatsheetseries.owasp.org/cheatsheets/DotNet_Security_Cheat_Sheet.html)

### Vulnerability 2

#### Exposure
*Sensitive Data Exposure* Securing the email addresses of admins.

*Hash Email:* When admins input their emial addresses they need to be secure from hackers finding their information. Instead of being hardcoded.

#### Repair

Register.cshtml.cs contains the vuknerability. We can address this issue by removing the hard coded allowed emails and storing that information in `usersecrets.json`

``` if (user.Email.ToLower() == "xxxxxxxxxxxxxxx@live.com" || user.Email.ToLower() == "xxxxxx.xxxxxx@yahoo.com"
                       || user.Email.ToLower() == "xxxxxxx@codefellows.com" || user.Email.ToLower() == "xxxxx.xxxxxxx@gmail.com"
                       || user.Email.ToLower() == "xxxxxxxxxx@gmail.com")
                    {
                        await _userManager.AddToRoleAsync(user, ApplicationRoles.Admin);
                        await _userManager.AddToRoleAsync(user, ApplicationRoles.Member);

                    }
                    else
                    {
                        await _userManager.AddToRoleAsync(user, ApplicationRoles.Member);

                    } 
```
                    
#### Resources

[OWASP - Broken Authentication](https://cheatsheetseries.owasp.org/cheatsheets/DotNet_Security_Cheat_Sheet.html)

### Vulnerability 3

#### Exposure

*Broken Authentication* Having plain text passwords opens up users to having their accounts hacked.

*Storing Passwords* When user data is viewed in the database, their passwords are shown in plain text. By hashing these passwords we can prevent this vulnerability.

#### Repair

Vulnerability exists in Register.cshtml.cs and Login.cshtml.cs

Including ASP.NET Core Identity provides an included default password hashing algorithm.
When users register, their passwords are automatically hashed and stored, upon login the algorithm checks the input password hash against the stored.

``` if (ModelState.IsValid)
            {
                var user = new ApplicationUser
                {
                    UserName = RegisterData.Email,
                    Email = RegisterData.Email,
                    FirstName = RegisterData.FirstName,
                    LastName = RegisterData.LastName,
                };
  ==========================================================
   public LoginModel(SignInManager<ApplicationUser> signInManager, IConfiguration configuration)
        {
            _signInManager = signInManager;
            _configuration = configuration;
        }
```

#### Resources

[OWASP - Broken Authentication](https://cheatsheetseries.owasp.org/cheatsheets/DotNet_Security_Cheat_Sheet.html)

### Vulnerability 4

#### Exposure
*Broken Access Control* Missing function-level access control

*Assigned Roles:* Without assigned roles, any user can access the admin pages.

#### Repair

Vulnerability exists on Register.cshtml.cs Login.cshtml.cs and Admin pages.
By using ASP.NET Core Authroization and assigning roles to specific users we can avoid this potetial vulnerability.

```
 if (user.Email.ToLower() == "carringtonbeard@live.com" || user.Email.ToLower() == "teddy.damian@yahoo.com"
                       || user.Email.ToLower() == "amanda@codefellows.com" || user.Email.ToLower() == "rice.jonathanm@gmail.com"
                       || user.Email.ToLower() == "brentshanahan@gmail.com")
                    {
                        await _userManager.AddToRoleAsync(user, ApplicationRoles.Admin);
                        await _userManager.AddToRoleAsync(user, ApplicationRoles.Member);

                    }
                    ============================================================
                     [Authorize(Policy = "AdminOnly")]
    public class AdminDashboardModel : PageModel
    {
```
#### Resources

[OWASP - Broken Authentication](https://cheatsheetseries.owasp.org/cheatsheets/DotNet_Security_Cheat_Sheet.html
